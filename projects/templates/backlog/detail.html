{% extends 'sga/layout/base_generic.html'%}
{% block content %}
	{% include 'utils/messages.html' %}
	<h1>{{user_story.code }} - {{ user_story.title}}</h1>
	<p><strong>Descripción:</strong> {{user_story.description}}</p>
	<p><strong>Prioridad:</strong> {{user_story.sprint_priority}}</p>
	<p><strong>Valor de negocio:</strong> {{user_story.business_value}}</p>
	<p><strong>Prioridad técnica:</strong> {{user_story.technical_priority}}</p>
	<p><strong>Estimación en horas:</strong> {{user_story.estimation_time}}</p>
	<p><strong>Estado:</strong> {{user_story.status}}</p>
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Comentarios</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Adjuntos</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="false">Tareas</button>
    </li>
  </ul>
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
      
      <a href="{% url 'projects:sprints:backlog-comment-create' project_id=user_story.project.id sprint_id=user_story.sprint.id user_story_id=user_story.id %}" class="btn btn-labeled btn-info">
        <span class="btn-label"><i class="fa fa-plus"></i></span>Agregar Comentario
      </a>

      <table class="table-custom">
        <thead>
          <tr>
            <th scope="col">Comentario</th>
            <th scope="col">Autor</th>
            <th scope="col">Fecha</th>
          </tr>
        </thead>
        <tbody>
          {% for comment in comments %}
          <tr height="60px">
            <td>{{ comment.comment }}</td>
            <td>{{ comment.project_member.user.email }}</td>
            <td>{{ comment.created_at }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>
    <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
      <ul class="list-group list-group-flush">
        {% for file in attachments%}
          <li class="list-group-item">
            {{file.filename}}
            <span class="badge text-bg-primary">{{file.size}}</span>
    
            <a href="{% url 'projects:us-attachment-download' project_id=project_id us_id=user_story.id attachment_id=file.id%}"
              class="btn" title="Descargar archivo">
              <i class="fa fa-download"></i>
            </a>
          </li>
        {% empty %}
          <li class="list-group-item">No hay archivos adjuntos</li>
        {% endfor %}
      </ul>
    </div>
    <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">
      Tareas
    </div>
  </div>
{% endblock %}

